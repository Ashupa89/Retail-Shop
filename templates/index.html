{% extends "base.html" %}
{% block content %}
<style>
    .dashboard-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    .dashboard-cards .card {
        flex: 1 1 200px;
        padding: 1rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        background: #fff;
        text-align: center;
        transition: transform 0.2s ease-in-out;
    }
    .dashboard-cards .card:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }
    .dashboard-cards .card h3 {
        font-size: 1rem;
        margin-bottom: 0.5rem;
    }
    .dashboard-cards .card p, .dashboard-cards .card ul {
        font-size: 0.9rem;
        margin: 0;
    }
    .dashboard-cards .low-stock ul {
        list-style: none;
        padding-left: 0;
    }
    .low-stock-item {
        background: #fff3cd;
        border-radius: 6px;
        padding: 0.3rem 0.5rem;
        margin-bottom: 0.3rem;
        font-size: 0.85rem;
    }
    .table thead th {
        font-size: 0.85rem;
    }
    .table tbody td {
        font-size: 0.83rem;
        vertical-align: middle;
    }
    .btn-invoice {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }
    .section-title {
        font-size: 1rem;
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
</style>

<h2 class="mb-3">Dashboard</h2>

<div class="dashboard-cards">
    <div class="card total-products">
        <h3>Total Products</h3>
        <p class="fw-bold fs-4">{{ products|length }}</p>
    </div>
    <div class="card recent-sales">
        <h3>Recent Sales</h3>
        <p class="fw-bold fs-4">{{ sales|length }}</p>
    </div>
    <div class="card low-stock">
        <h3>Low Stock Alerts</h3>
        {% if low_stock %}
        <ul>
            {% for p in low_stock %}
            <li class="low-stock-item">{{ p.name }} ({{ p.quantity }} left)</li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-muted">No low stock alerts.</p>
        {% endif %}
    </div>
</div>

<h3 class="section-title">Recent Sales Details</h3>
<div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
        <thead class="table-primary text-center">
        <tr>
            <th>Date & Time</th>
            <th>Invoice No.</th>
            <th>Product Name</th>
            <th>Quantity</th>
            <th>Total (â‚¹)</th>
            <th>Customer Name</th>
            <th>Invoice</th>
        </tr>
        </thead>
        <tbody>
        {% for s in sales %}
        <tr class="text-center">
            <td>
                {% if s.created_at %}
                {{ s.created_at.strftime("%d-%m-%Y %I:%M %p") }}
                {% else %}N/A{% endif %}
            </td>
            <td>{{ s.invoice_no }}</td>
            <td>{{ s.product_name }}</td>
            <td>{{ s.quantity }}</td>
            <td>{{ '%.2f'|format(s.total or 0) }}</td>
            <td>{{ s.customer_name }}</td>
            <td>
                <a class="btn btn-success btn-invoice" href="/invoice/{{ s.invoice_no }}" target="_blank" title="Open Invoice {{ s.invoice_no }}">
                    <i class="fa-solid fa-file-pdf"></i> Invoice
                </a>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="7" class="text-center text-muted">No sales records found.</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
